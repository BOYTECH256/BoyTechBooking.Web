@model HomeConcertDetailsViewModel
@{
    ViewData["Title"] = "Details";
}

<h1>Details</h1>

<div class="container mt-4">
    <div class="row g-4">
        <div class="col-md-6">
            <img src="@Model.ConcertImage" alt="Concert image" class="img-fluid rounded" style="width:100%; height:auto; max-height:460px; object-fit:cover;" />
        </div>

        <div class="col-md-6">
            <h2 class="mb-1">@Model.ConcertName</h2>
            <p class="text-muted mb-2">@Model.VenueName — @Model.VenueAddress</p>
            <p class="mb-2"><strong>Date &amp; time:</strong> @Model.ConcertDateTime.ToString("MMMM dd, yyyy 'at' hh:mm tt")</p>

            <div class="mb-3">
                <strong>Artist</strong>
                <div class="d-flex align-items-center mt-2">
                    <img src="@Model.ArtistImage" alt="Artist" class="rounded-circle me-3" style="width:72px; height:72px; object-fit:cover;" />
                    <div>
                        <div>@Model.ArtistName</div>
                    </div>
                </div>
            </div>

            <div class="mb-4">
                <h5>Description</h5>
                <p>@Model.Description</p>
            </div>

            <div class="mb-3">
                @* Actions & payment/booking flow *@
                @if (User.Identity?.IsAuthenticated == true)
                {
                    if (Model.HasPaidForThisConcert)
                    {
                        <div class="alert alert-success py-2">
                            <strong>Paid</strong> — you are eligible to book tickets.
                            @if (Model.TotalPaidForThisConcert > 0)
                            {
                                <div class="small mt-1">Total paid for this concert: @Model.TotalPaidForThisConcert.ToString("C")</div>
                            }
                        </div>

                        <div class="d-flex flex-wrap gap-2">
                            <a asp-controller="Bookings" asp-action="Book" asp-route-concertId="@Model.ConcertId" class="btn btn-success">Book Tickets</a>
                            <a asp-controller="Home" asp-action="AvailableTickets" asp-route-id="@Model.ConcertId" class="btn btn-outline-primary">See Available Tickets</a>
                            <a asp-controller="Bookings" asp-action="MyBookings" class="btn btn-link">My Bookings</a>
                        </div>
                    }
                    else
                    {
                        <div class="alert alert-warning py-2">
                            <strong>Payment required</strong> — you must pay for this concert before booking.
                        </div>

                        <div class="d-flex flex-wrap gap-2">
                            <a class="btn btn-primary" href="/Payment/Start?concertId=@Model.ConcertId">Pay for this concert</a>
                            <a asp-controller="Home" asp-action="AvailableTickets" asp-route-id="@Model.ConcertId" class="btn btn-outline-secondary">View Seats</a>
                        </div>
                    }
                }
                else
                {
                    <div class="alert alert-info py-2">
                        <a asp-area="Identity" asp-page="/Account/Login">Sign in</a> to pay and book tickets for this concert.
                    </div>
                }
            </div>

            @* Admin controls *@
            @if (User.IsInRole("Admin"))
            {
                <div class="mt-3">
                    <a asp-controller="Concerts" asp-action="Edit" asp-route-id="@Model.ConcertId" class="btn btn-warning">Edit</a>
                    <a asp-controller="Concerts" asp-action="Delete" asp-route-id="@Model.ConcertId" class="btn btn-danger" onclick="return confirm('Delete this concert?');">Delete</a>
                    <a asp-controller="Concerts" asp-action="GetTickets" asp-route-id="@Model.ConcertId" class="btn btn-secondary">View Bookings</a>
                    <a asp-controller="Payments" asp-action="Index" class="btn btn-outline-info">Payments</a>
                </div>
            }
        </div>
    </div>
</div>
<form asp-controller="PayPal" asp-action="CreateOrder" method="post">
    <input type="hidden" name="amount" value="19.99" />
    <input type="hidden" name="currency" value="USD" />
    <button type="submit" class="btn btn-primary">Pay with PayPal</button>
    @Html.AntiForgeryToken()
</form>